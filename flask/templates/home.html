{% extends 'index.html' %}
{% block content %}

<a href="/"><span class="material-symbols-outlined">
	arrow_back
	</span></a>

<table>
	<thead>
		<tr>
			<th>CVE</th>
			<th>Description</th>
			<th>Severity</th>
			<th>Date</th>
			<th>Link</th>

		</tr>
	</thead>

	<tbody>
	
		{% for vulnerability in data %}
		<tr id="table">
			<th class="thSearch">{{ vulnerability['cve']['id'] }}</th>
			<th class="thSearch">{{ vulnerability['cve']['descriptions'][0]['value'] }}</th>

			{% if 'cvssMetricV2' in vulnerability['cve']['metrics'] %}
			<th class="thSearch">{{ vulnerability['cve']['metrics']['cvssMetricV2'][0]['baseSeverity'] }}</th>
			{% elif 'cvssMetricV30' in vulnerability['cve']['metrics'] %}
			<th class="thSearch">{{ vulnerability['cve']['metrics']['cvssMetricV30'][0]['baseSeverity'] }}</th>
			{% else %}
			<th class="thSearch">Unknown</th>
			{% endif %}
			<th class="thSearch">{{ vulnerability['cve']['published'] }}</th>
			{% if vulnerability['cve']['references']|length > 0 %}
			<th class="thSearch"><a target="_blank" href="{{ vulnerability['cve']['references'][0]['url'] }}">
				<span class="material-symbols-outlined">
					link
				</span>
				</a>
			</th>
			{% else %}
			<th class="thSearch">Unknown</th>
			{% endif %}
		</tr>
		{% endfor %}
	</tbody>
	
</table>

<script>
	var searchInput=document.getElementById("searchbar");
	var buttonSearch=document.getElementById("searchButton");
	//var table=document.getElementById('table');
	const cases=[...document.querySelectorAll('.thSearch')];

	const filterFunc = function(event,input,listItems){
		console.log("bonjour");
		const search=input.value.toLowerCase();
		console.log('search : '+search);

		listItems.forEach(li => {
			li.parentNode.hidden=true;
		})

		listItems.forEach(li => {
			const stringFound=li.innerText.toLowerCase().indexOf(search) !== -1;
			if(stringFound){
				li.parentNode.hidden=false;
			}
		});

	}
</script>

{% endblock %}
